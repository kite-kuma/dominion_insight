+++
date = '2025-10-01T18:07:38+09:00'
draft = false
title = 'フェイズ戻り周辺に関するバグ'
+++

## 概要
Dominion Online (以下オンライン) には正しいルールと整合的でない挙動を示す部分がわずかにある．
今回はその中からフェイズ戻りに関するものを紹介する．
これはカードの処理の途中でフェイズの変更がなされないことによるものである．

## 2022 年エラッタ
まずは今回の話を理解するための前提を説明する．

ドミニオンの一部のカードやイベントには購入フェイズからアクションフェイズに戻る効果を持つものがある．
ヴィラ，騎兵隊，発進，継続などが該当する．
また，一部のカードなどは購入フェイズの終了時に誘発する効果をもつ．
ワイン商，商人ギルド，隠遁者，野外劇などが該当する．

以前は購入フェイズからアクションフェイズに戻る際に購入フェイズの終了時に誘発する効果が誘発されなかったが，[2022 年エラッタ](https://wikiwiki.jp/dominiondeck/%E6%B5%B7%E8%BE%BA%E3%83%BB%E7%B9%81%E6%A0%84%E3%83%BB%E7%95%B0%E9%83%B72%E7%89%88%E7%99%BA%E8%A1%A8%E3%81%AB%E4%BC%B4%E3%81%862022%E5%B9%B4%E7%89%88%E3%82%A8%E3%83%A9%E3%83%83%E3%82%BF)により誘発するようにルールの変更がなされた．


## バグの内容
購入フェイズからアクションフェイズに戻る効果を持つカードのうち，テキストと処理順が異なるものがある．
特に，フェイズの切り替わりのタイミングが正しい挙動と異なっている．

## 具体例
### 発進
カードテキスト：

```
1 ターンに 1 度のみ：アクションフェイズに戻る。+1 カードを引く、+1 アクション、+1 購入。
```

オンラインでの実際の挙動：

```
1 ターンに 1 度のみ：+1 カードを引く、+1 アクション、+1 購入。アクションフェイズに戻る。
```

例えば宝物庫使用 → 発進とした場合，本来のルールでは購入フェイズが先に終了するので，デッキ上に移動する宝物庫を発進の 1 ドローで引くことになる．対してオンラインでは先に 1 ドローしてから宝物庫をデッキに載せることになる．

### 継続
カードテキスト：
```
1 ターンに 1 度のみ：アタックでないコスト 4 以下のアクションカード 1 枚を獲得する。
アクションフェイズに戻り、それを使用する。+1 アクション、+1 購入。
```

オンラインでの実際の挙動：
```
1 ターンに 1 度のみ：アタックでないコスト 4 以下のアクションカード 1 枚を獲得する；それを使用する。+1 アクション、+1 購入。アクションフェイズに戻る。
```

発進と同様に，アクションフェイズに戻るのが一連の処理の最後となっている．

購入フェイズの終了時に誘発する効果に関連しないものを挙げると，以下のような違いもある．
* 値下がりした冠を継続で獲得・使用する場合に，本来の挙動ならアクションフェイズ中の使用となるはずが，オンラインでは購入フェイズ中の使用となる．

{{< figure src="/continue_crown.png" alt="冠が購入フェイズに使用されているため，銅貨を二度使用することができてしまっている" width=400 >}}

### ヴィラ
カードテキスト (獲得時効果のみ):
```
あなたがこのカードを獲得するとき、これをあなたの手札に加え、+1 アクション、
そしてあなたの購入フェイズである場合、アクションフェイズに戻る。
```

オンラインでの実際の挙動：
```
あなたがこのカードを獲得するとき、これをあなたの手札に加え、+1 アクション。**その後，誘発している他の処理全てが終了したとき**、あなたの購入フェイズである場合、アクションフェイズに戻る。
```

太字の箇所は**他のカードの処理などを全て処理してからフェイズが戻る**という意味である．例えば，購入フェイズに苦労の効果で使用した馬丁でヴィラを獲得したとする．
このとき馬丁の効果による馬の獲得が行われた後にアクションフェイズに戻る．

#### 挙動の違いが問題になる例
上の状況でティアラが場に出ている場合，馬丁により獲得した馬をデッキトップに置いてから，購入フェイズ終了時の効果により宝物庫が上に置かれることになるが，正しいルールではこれは行えない．正しいルールでは必ず宝物庫が下になる．

### 騎兵隊
カードテキスト (獲得時効果のみ):
```
このカードを獲得するとき、+2 カードを引く、+1 カードを購入，そして現在があなたの購入フェイズの場合、あなたのアクションフェイズに戻る。
```

オンラインでの実際の挙動：

```
このカードを獲得するとき、+2 カードを引く、+1 カードを購入。**その後，誘発している他の処理全てが終了したとき**、あなたの購入フェイズである場合、アクションフェイズに戻る。
```

違いが問題になる状況についてはヴィラと同様なので省略する．

---

ヴィラや騎兵隊はかなり複雑な状況でないと問題にならなさそうだが，発進や継続で宝物庫を再使用するのは狙いうるので，今の仕様はあまり良くないのではと思う．レート戦では注意したい．
